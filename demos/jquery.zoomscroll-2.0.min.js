/*
 * ZoomScroll - FancyBox Plugin
 * Zooming image with scroll
 *
 * Examples and documentation at: http://zoomscroll.com/
 *
 * Copyright (c) 2011 Kirill Shaparov, http://shaparov.ru/
 *
 * Version: 2.0 (08/12/2011)
 * Requires: jQuery v1.3+
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 */
(function(a){var h="",c=new Image,e=0,f=0,j=l_b=20,b=w_o=0,z1="#zoomscroll-image-view",z2="#zoomscroll-image-preload",z3="#zoomscroll-image-overlay",z4="#zoomscroll-image-close",k=function(){w_n=w_o-l_b;a(z1).css({width:w_n});h_n=f*w_n/e;a(z1).css({height:h_n})},l=function(){h_n=b-j;a(z1).css({height:h_n});w_n=e*h_n/f;a(z1).css({width:w_n})},m=function(){a(z1).draggable({cursor:"move",scroll:!1,containment:[30-a(z1).width(),30-a(z1).height(),w_o-30,b-30]})},n=function(d){a(z1).animate({opacity:d},300,function(){d?a("body").css({overflow:"hidden",position:"fixed",width:"100%",height:"100%"}):(a(z3+", "+z4+", "+z1).remove(),a("body").css({overflow:"",position:"",width:"",height:""}))})},o=function(){e=c.width;f=c.height;a(z2).remove();a("body").append("<div id='zoomscroll-image-overlay'></div><img id='zoomscroll-image-view' src='"+h+"' /><div id='zoomscroll-image-close'></div>");a(z3).css({height:a(window).height()+20});b=a(window).height();w_o=a(window).width();e>w_o-l_b?(k(),h_n>b-j&&l()):f>b-j?(l(),w_n>w_o-l_b&&k()):(h_n=f,w_n=e);a(z1).css({top:(b-h_n)/2,left:(w_o-w_n)/2});a(z3+", "+z4).live("click",a.zoomscroll.close);a(z1).bind("mousewheel",function(d,b){a(z1).stop();var g=a(z1).width(),c=a(z1).height(),e=d.layerX==void 0?d.offsetX:d.layerX,f=d.layerY==void 0?d.offsetY:d.layerY;a(z3).width();a(z3).height();var i=b>0?1.25:0.555;if(!(g<100&&b<0||g>1E4&&b>0)){var h=g+b*Math.round(g*i),i=c+b*Math.round(c*i),g=Math.ceil(a(z1).position().left-e*(h/g-1)),c=Math.ceil(a(z1).position().top-f*(i/c-1));a(z1).draggable("destroy");a(z1).animate({left:g,width:h,top:c,height:i},600,m)}});a(z1).dblclick(function(){a(z1).draggable("destroy");a(z1).stop().animate({width:w_n,height:h_n,left:(w_o-w_n)/2,top:(b-h_n)/2},500,m)});a(z1).live("mousedown",function(){return!1});a(z1).draggable({containment:[30-w_n,30-h_n,w_o-30,b-30]});n(1)};a.fn.zoomscroll=function(){a(this).live("click",a.zoomscroll.open);h=a(this).attr("href");return this};a.zoomscroll=function(){};a.zoomscroll.open=function(){if(a(z2).length)return!1;a(this).append("<div id='zoomscroll-image-preload'></div>");a(z2).css({"margin-left":a(this).find("img").width()/2-21,"margin-top":-(a(this).find("img").height()/2+21)});c.src=h;c.complete?o():c.onload=o;return!1};a.zoomscroll.close=function(){n(0)}})(jQuery);